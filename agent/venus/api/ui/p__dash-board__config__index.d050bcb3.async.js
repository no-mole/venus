"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[641],{38303:function(e,n,t){var r=t(30486),a=t(56453),o=t(62086),u=t(90413),i=t(53910),l=t(6310),s=t(41930),c=t(57910),d=t(62995),f=t(84875),p=t.n(f),m=t(93236),v=["key","name"],h=function(e){var n=e.className,t=e.style,u=e.onSelect,d=e.menus,f=void 0===d?[]:d,h=e.children,x=(0,(0,m.useContext)(s.ZP.ConfigContext).getPrefixCls)("pro-table-dropdown"),y=(0,l.Q)({onClick:function(e){null==u||u(e.key)},items:f.map((function(e){var n=e.key,t=e.name,o=(0,r.Z)(e,v);return(0,a.Z)((0,a.Z)({key:n},o),{},{title:o.title,label:t})}))});return(0,o.jsx)(c.Z,(0,a.Z)((0,a.Z)({},y),{},{className:p()(x,n),children:(0,o.jsx)("a",{style:t,children:h||(0,o.jsx)(i.Z,{})})}))};h.Button=function(e){var n=e.children,t=e.menus,r=e.onSelect,i=e.className,f=e.style,v=(0,(0,m.useContext)(s.ZP.ConfigContext).getPrefixCls)("pro-table-dropdown"),h=(0,l.Q)({onClick:function(e){return r&&r(e.key)},items:null==t?void 0:t.map((function(e){return{label:e.name,key:e.key}}))});return(0,o.jsx)(c.Z,(0,a.Z)((0,a.Z)({},h),{},{className:p()(v,i),children:(0,o.jsxs)(d.Z,{style:f,children:[n," ",(0,o.jsx)(u.Z,{})]})}))},n.Z=h},91977:function(e,n,t){t.d(n,{Z:function(){return g}});var r=t(35290),a=t.n(r),o=t(30279),u=t.n(o),i=t(411),l=t.n(i),s=t(46686),c=t.n(s),d=t(10571),f=t(76405),p=t(1896),m=t(87679),v=t(93236),h=t(69840),x=(t(28768),t(66215),t(36941),t(13838),t(95368),t(3531),t(49355),t(63987),t(72054),t(62644),t(35757),t(79132),t(7699),t(13424),t(94602),t(57860),t(78035),t(42150),t(62086)),y=function(e){var n,t=e.codeValue,r=e.type,a=e.formType,o=e.changeCode,u=(0,v.useState)(""),i=c()(u,2),l=i[0],s=i[1];return(0,v.useEffect)((function(){setTimeout((function(){var e,r;(n=null===(e=document)||void 0===e||null===(r=e.querySelector("div.CodeMirror"))||void 0===r?void 0:r.CodeMirror).refresh(),s("string"==typeof t?JSON.parse(t):JSON.stringify(t,null,2))}),500)}),[]),(0,v.useEffect)((function(){var e,t;n=null===(e=document)||void 0===e||null===(t=e.querySelector("div.CodeMirror"))||void 0===t?void 0:t.CodeMirror,setTimeout((function(){n.refresh()}),100)}),[r]),(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(h.fk,{value:l,onBeforeChange:function(e,n,t){t&&(o(e,n,t),"新建"!==a&&"编辑"!==a||s(t))},options:{lineWrapping:!0,autofocus:!0,indentWithTabs:!0,mode:{name:"yaml"===r||"toml"===r||"properties"===r?"text/x-"+r:"text/jsx",json:!0},theme:"material",lineNumbers:!0,readOnly:"详情"===a,smartIndent:!0,indentUnit:4,foldGutter:!0,styleActiveLine:!0,matchBrackets:!0,autoRefresh:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],extraKeys:{Ctrl:"autocomplete","Ctrl-S":function(e){},"Ctrl-Z":function(e){e.undo()},F8:function(e){e.redo()}},autoCloseBrackets:!0}})})},g=function(e){var n,t,r=(0,v.useRef)(),o=(0,v.useState)(),i=c()(o,2),s=i[0],h=i[1],g=(0,v.useState)(""),k=c()(g,2),j=k[0],C=k[1];(0,v.useEffect)((function(){var e;C(null==r||null===(e=r.current)||void 0===e?void 0:e.getFieldValue(type))}),[]),(0,v.useEffect)((function(){var n;h(null==e||null===(n=e.values)||void 0===n?void 0:n.value)}),[null==e||null===(n=e.values)||void 0===n?void 0:n.value]);return(0,x.jsxs)(d.Y,{initialValues:e.values,formRef:r,title:"配置".concat(e.formType),open:e.updateModalVisible,autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:function(){return e.onCancel()}},submitTimeout:2e3,onFinish:function(){var n=l()(a()().mark((function n(t){var r;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=u()(u()({},t),{},{value:s}),e.onSubmit(r);case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),width:640,disabled:"详情"===e.formType,children:[(0,x.jsx)(f.A.Group,{children:(0,x.jsx)(p.Z,{width:"xl",name:"alias",label:"配置名称",rules:[{required:!0,message:"请输入配置名称！"}]})}),(0,x.jsx)(f.A.Group,{children:(0,x.jsx)(p.Z,{width:"xl",name:"key",label:"唯一标识",rules:[{required:!0,message:"请输入唯一标识！"}]})}),(0,x.jsx)(f.A.Group,{children:(0,x.jsx)(p.Z,{width:"xl",name:"description",label:"描述"})}),(0,x.jsx)(f.A.Group,{children:(0,x.jsx)(m.Z.Group,{name:"data_type",label:"数据类型",options:["text","json","yaml","toml","properties","ini"],rules:[{required:!0,message:"请选择数据类型！"}],fieldProps:{onChange:function(e){var n;null==r||r.current.setFieldsValue({type:e.target.value}),C(e.target.value),console.log(null==r||null===(n=r.current)||void 0===n?void 0:n.getFieldValue("type"))}}})}),"详情"===e.formType?(0,x.jsx)(f.A.Group,{children:(0,x.jsx)(p.Z,{disabled:!0,width:"xl",name:"version",label:"数据版本",rules:[{required:!0,message:"请输入数据版本！"}]})}):"",(0,x.jsxs)("p",{style:{marginBottom:20},children:[(0,x.jsx)("em",{style:{color:"#ff4d4f",marginInlineEnd:4},children:"*"}),"配置内容:"]}),(0,x.jsx)(y,{changeCode:function(e,n,t){t&&h(JSON.stringify(t))},codeValue:null==e||null===(t=e.values)||void 0===t?void 0:t.value,type:j,setDataType:C,formType:e.formType})]})}},24491:function(e,n,t){t.r(n);var r=t(35290),a=t.n(r),o=t(30279),u=t.n(o),i=t(411),l=t.n(i),s=t(46686),c=t.n(s),d=t(38303),f=t(10305),p=t(13246),m=t(61388),v=t(51955),h=t(59019),x=t(62995),y=t(93236),g=t(91977),k=t(78076),j=t(22240),C=t(62086);n.default=function(){var e=(0,y.useState)(!1),n=c()(e,2),t=n[0],r=n[1],o=(0,y.useState)({}),i=c()(o,2),s=i[0],Z=i[1],b=(0,y.useState)(""),w=c()(b,2),S=w[0],T=w[1],R=(0,y.useRef)(),I=(0,m.useModel)("useUser").select,P=localStorage.getItem("use-local-storage-state-namespace"),N="";P&&(N=JSON.parse(P).value),(0,y.useEffect)((function(){R.current&&R.current.reload()}),[I]);var F=function(){var e=l()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.ZP.loading("正在配置"),e.prev=1,e.next=4,(0,j.oR)(u()(u()({},n),{},{namespace:N}));case 4:return t(),v.ZP.success("配置成功"),e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(1),t(),v.ZP.error("配置失败请重试！"),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(n){return e.apply(this,arguments)}}(),M=function(){var e=l()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.ZP.loading("正在删除"),n){e.next=3;break}return e.abrupt("return",!0);case 3:return e.prev=3,e.next=6,(0,j.vj)({namespace:N,key:null==n?void 0:n.key});case 6:return t(),v.ZP.success("删除成功"),null===(r=R.current)||void 0===r||r.reload(),e.abrupt("return",!0);case 12:return e.prev=12,e.t0=e.catch(3),t(),v.ZP.error("删除失败，请重试"),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(n){return e.apply(this,arguments)}}(),G=[{title:"配置项名称",dataIndex:"alias"},{title:"唯一标识",dataIndex:"key",valueType:"text",hideInSearch:!0},{title:"版本",dataIndex:"version",hideInSearch:!0},{title:"最近更新时间",hideInSearch:!0,valueType:"dateTime",dataIndex:"update_time"},{title:"操作",dataIndex:"option",valueType:"option",render:function(e,n){return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("a",{onClick:function(){r(!0),Z(n),T("详情")},rel:"noopener noreferrer",style:{marginRight:8},children:"查看"}),(0,C.jsx)("a",{style:{marginRight:8},onClick:function(){r(!0),Z(n),T("编辑")},children:"编辑"}),(0,C.jsx)(h.Z,{placement:"topLeft",title:"确认删除配置项".concat(null==n?void 0:n.alias,"吗"),onConfirm:function(){M(n)},okText:"确定",cancelText:"取消",children:(0,C.jsx)("a",{style:{marginRight:8},children:"删除"})}),(0,C.jsx)(d.Z,{onSelect:function(e){return m.history.push({pathname:"/dash-board/config/".concat(e,"?namespace=").concat(null==n?void 0:n.namespace,"&key=").concat(null==n?void 0:n.key,"&alias=").concat(null==n?void 0:n.alias)})},menus:[{key:"history",name:"查看历史"},{key:"list",name:"监听查询"}]},"actionGroup")]})}}];return(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(f._z,{header:{title:"配置列表"},style:{paddingTop:0},children:[(0,C.jsx)(p.Z,{headerTitle:"",actionRef:R,rowKey:function(e){return null==e?void 0:e.key},search:{labelWidth:80},toolBarRender:function(){return[(0,C.jsx)(x.Z,{type:"primary",onClick:function(){r(!0),Z(""),T("新建")},children:"新建"},"create")]},request:function(){var e=l()(a()().mark((function e(n,t,r){var o,i,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,j.hp)(u()(u()({namespace:N},n),{},{sorter:t,filter:r}));case 2:return o=e.sent,i=o.data,l=o.success,e.abrupt("return",{data:i||[],success:l});case 6:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),columns:G,rowClassName:function(e,n){var t=k.Z.lightRow;return n%2==1&&(t=k.Z.darkRow),t}}),(0,C.jsx)(g.Z,{formType:S,onSubmit:function(){var e=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(n);case 2:e.sent&&(r(!1),Z({}),R.current&&R.current.reload());case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),onCancel:function(){r(!1),Z({})},updateModalVisible:t,values:s})]})})}},78076:function(e,n){n.Z={darkRow:"darkRow___94Git","panel-table":"panel-table___tjWYN"}}}]);
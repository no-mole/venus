"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[895],{87679:function(e,r,n){var t=n(56453),a=n(30486),u=n(62086),o=n(63502),i=n(50695),s=n(93236),l=n(97162),c=n(12961),p=["fieldProps","options","radioType","layout","proFieldProps","valueEnum"],d=s.forwardRef((function(e,r){var n=e.fieldProps,i=e.options,s=e.radioType,l=e.layout,d=e.proFieldProps,f=e.valueEnum,m=(0,a.Z)(e,p);return(0,u.jsx)(c.Z,(0,t.Z)((0,t.Z)({valueType:"button"===s?"radioButton":"radio",ref:r,valueEnum:(0,o.h)(f,void 0)},m),{},{fieldProps:(0,t.Z)({options:i,layout:l},n),proFieldProps:d,filedConfig:{customLightMode:!0}}))})),f=s.forwardRef((function(e,r){var n=e.fieldProps,a=e.children;return(0,u.jsx)(i.ZP,(0,t.Z)((0,t.Z)({},n),{},{ref:r,children:a}))})),m=(0,l.G)(f,{valuePropName:"checked",ignoreWidth:!0});m.Group=d,m.Button=i.ZP.Button,m.displayName="ProFormComponent",r.Z=m},37655:function(e,r,n){var t=n(56453),a=n(30486),u=n(62086),o=n(63502),i=n(93236),s=n(84650),l=n(12961),c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],p=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],d=i.forwardRef((function(e,r){var n=e.fieldProps,p=e.children,d=e.params,f=e.proFieldProps,m=e.mode,v=e.valueEnum,h=e.request,x=e.showSearch,w=e.options,Z=(0,a.Z)(e,c),P=(0,i.useContext)(s.Z);return(0,u.jsx)(l.Z,(0,t.Z)((0,t.Z)({valueEnum:(0,o.h)(v),request:h,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,t.Z)({options:w,mode:m,showSearch:x,getPopupContainer:P.getPopupContainer},n),ref:r,proFieldProps:f},Z),{},{children:p}))})),f=i.forwardRef((function(e,r){var n=e.fieldProps,c=e.children,d=e.params,f=e.proFieldProps,m=e.mode,v=e.valueEnum,h=e.request,x=e.options,w=(0,a.Z)(e,p),Z=(0,t.Z)({options:x,mode:m||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},n),P=(0,i.useContext)(s.Z);return(0,u.jsx)(l.Z,(0,t.Z)((0,t.Z)({valueEnum:(0,o.h)(v),request:h,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,t.Z)({getPopupContainer:P.getPopupContainer},Z),ref:r,proFieldProps:f},w),{},{children:c}))})),m=d;m.SearchSelect=f,m.displayName="ProFormComponent",r.Z=m},14028:function(e,r,n){n.r(r),n.d(r,{default:function(){return k}});var t=n(30279),a=n.n(t),u=n(35290),o=n.n(u),i=n(411),s=n.n(i),l=n(46686),c=n.n(l),p=n(10305),d=n(13246),f=n(51955),m=n(59019),v=n(62995),h=n(93236),x=n(10571),w=n(76405),Z=n(37655),P=n(1896),y=n(87679),b=n(62086),g=function(e){var r,n;return(0,b.jsxs)(x.Y,{title:null==e?void 0:e.formType,visible:e.updateModalVisible,autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:function(){return e.onCancel()}},submitTimeout:2e3,onFinish:null==e?void 0:e.onSubmit,width:440,initialValues:{namespace_alias:null==e?void 0:e.namespace_alias,namespace_uid:null==e?void 0:e.namespace_uid,uid:null==e||null===(r=e.values)||void 0===r?void 0:r.uid,role:null==e||null===(n=e.values)||void 0===n?void 0:n.role},children:[(0,b.jsx)(w.A.Group,{children:(0,b.jsx)(Z.Z,{width:"xl",name:"uid",label:"用户名称",fieldProps:{fieldNames:{label:"name",value:"uid"}},options:null==e?void 0:e.userList,rules:[{required:!0,message:"请输入用户名称！"}]})}),(0,b.jsx)(w.A.Group,{children:(0,b.jsx)(P.Z,{width:"xl",name:"namespace_alias",label:"命名空间名称",disabled:!0,rules:[{required:!0,message:"请输入命名空间名称！"}]})}),(0,b.jsx)(w.A.Group,{children:(0,b.jsx)(P.Z,{width:"xl",name:"namespace_uid",label:"命名空间标识",disabled:!0,rules:[{required:!0,message:"命名空间标识！"}]})}),(0,b.jsx)(w.A.Group,{children:(0,b.jsx)(y.Z.Group,{name:"role",label:"角色",options:[{label:"只读成员",value:"r"},{label:"空间管理员",value:"wr"}],rules:[{required:!0,message:"请选择角色！"}]})})]})},j=n(78076),C=n(8462),_=n(61388),k=function(){var e=(0,h.useState)(!1),r=c()(e,2),n=r[0],t=r[1],u=(0,h.useState)({}),i=c()(u,2),l=i[0],x=i[1],w=(0,h.useState)(""),Z=c()(w,2),P=Z[0],y=Z[1],k=(0,h.useRef)(),E=(0,_.useLocation)().search,S=(0,h.useState)(""),T=c()(S,2),F=T[0],q=T[1],R=(0,h.useState)(""),G=c()(R,2),I=G[0],L=G[1],N=(0,h.useState)([]),A=c()(N,2),M=A[0],V=A[1],B=(0,_.useModel)("useUser",(function(e){return{select:e.select,add:e.increment}})),O=B.add,U=B.select,W=localStorage.getItem("use-local-storage-state-namespace"),Y=new URLSearchParams(E),z=Y.get("namespaceUid"),D=Y.get("namespaceAlias"),J=function(){var e=s()(o()().mark((function e(){var r,n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C.lE)();case 2:0===(null==(r=e.sent)?void 0:r.code)?V((null==r||null===(n=r.data)||void 0===n?void 0:n.items)||[]):f.ZP.error("用户列表数据获取失败");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=s()(o()().mark((function e(r){var n,t,u;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.ZP.loading("正在添加"),t=null==M?void 0:M.filter((function(e){return(null==e?void 0:e.uid)===(null==r?void 0:r.uid)})),e.prev=2,e.next=5,(0,C.pe)(a()(a()({},r),{},{user_name:null===(u=t[0])||void 0===u?void 0:u.name}));case 5:return n(),f.ZP.success("添加成功"),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(2),n(),f.ZP.error("添加失败请重试！"),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(r){return e.apply(this,arguments)}}(),H=function(){var e=s()(o()().mark((function e(r){var n,t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.ZP.loading("正在删除"),e.prev=1,e.next=4,(0,C.wI)({uid:null==r?void 0:r.uid,namespace:null==r?void 0:r.namespace_uid});case 4:return n(),O(""),null==k||null===(t=k.current)||void 0===t||t.reload(),f.ZP.success("删除成功"),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(1),n(),f.ZP.error("删除失败，请重试"),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(r){return e.apply(this,arguments)}}();(0,h.useEffect)((function(){if(W){var e=JSON.parse(W);q(null==e?void 0:e.value),L(null==e?void 0:e.label),k.current&&k.current.reload()}}),[U]),(0,h.useEffect)((function(){z&&(q(z),L(D))}),[]);var Q=function(e,r){t(!0),x(r),y(e),J()},X=[{title:"用户名称",dataIndex:"user_name"},{title:"用户邮箱",dataIndex:"uid",valueType:"text"},{title:"角色",dataIndex:"role",valueType:"text",valueEnum:{wr:{text:"空间管理员"},r:{text:"只读成员"}}},{title:"创建时间",dataIndex:"update_time"},{title:"操作",dataIndex:"option",valueType:"option",render:function(e,r){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.Z,{placement:"topLeft",title:"删除用户".concat(null==r?void 0:r.user_name,"对命名空间").concat(null==r?void 0:r.namespace_alias,"的访问授权？"),onConfirm:function(){return H(r)},okText:"确定",cancelText:"取消",children:(0,b.jsx)("a",{style:{marginRight:8},children:"删除"})}),(0,b.jsx)("a",{onClick:function(){return Q("修改",r)},rel:"noopener noreferrer",style:{marginRight:8},children:"修改授权"})]})}}];return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(p._z,{header:{title:"命名空间用户权限管理"},children:[(0,b.jsx)(d.Z,{headerTitle:"",actionRef:k,rowKey:"uid",search:!1,options:!1,toolBarRender:function(){return[(0,b.jsx)(v.Z,{type:"primary",onClick:function(){return Q("新建","")},children:"新建"},"1")]},request:function(){var e=s()(o()().mark((function e(r,n,t){var u,i,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C.gp)(a()(a()({},r),{},{sorter:n,filter:t,namespace:F}));case 2:return u=e.sent,i=u.data,s=u.success,e.abrupt("return",{data:(null==i?void 0:i.items)||[],success:s});case 6:case"end":return e.stop()}}),e)})));return function(r,n,t){return e.apply(this,arguments)}}(),columns:X,rowClassName:function(e,r){var n=j.Z.lightRow;return r%2==1&&(n=j.Z.darkRow),n}}),(0,b.jsx)(g,{formType:P,userList:M,namespace_alias:I,namespace_uid:F,onSubmit:function(){var e=s()(o()().mark((function e(r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(r);case 2:e.sent&&(t(!1),x({}),O(""),k.current&&k.current.reload());case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),onCancel:function(){t(!1),x({})},updateModalVisible:n,values:l})]})})}},8462:function(e,r,n){n.d(r,{gp:function(){return s},lE:function(){return m},pe:function(){return c},wI:function(){return d}});var t=n(35290),a=n.n(t),u=n(411),o=n.n(u),i=n(61388);function s(e){return l.apply(this,arguments)}function l(){return(l=o()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/namespace/".concat(r.namespace,"/user"),{method:"GET"}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e){return p.apply(this,arguments)}function p(){return(p=o()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/namespace/".concat(r.namespace_uid,"/user/").concat(r.uid),{method:"POST",data:r}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){return f.apply(this,arguments)}function f(){return(f=o()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/namespace/".concat(r.namespace,"/user/").concat(r.uid),{method:"DELETE"}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return v.apply(this,arguments)}function v(){return(v=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/user",{method:"GET"}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},78076:function(e,r){r.Z={darkRow:"darkRow___94Git","panel-table":"panel-table___tjWYN"}}}]);